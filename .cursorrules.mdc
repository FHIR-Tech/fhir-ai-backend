# Cursor AI MDC Rules

This file defines the rules for Cursor AI when generating, scaffolding, and refactoring code
in the HealthTech.FhirNet8 project.

## Architecture
- Follow Clean Architecture (.NET 8, FHIR/HL7, PostgreSQL).
- Layers: Domain, Application, Integration, Infrastructure, Api.
- Dependencies: Only inward.

## Rules
1. All use cases via CQRS (MediatR). Handlers must be validated (FluentValidation).
2. FHIR resources stored in PostgreSQL JSONB with GIN indexes and RLS by tenant.
3. HL7 v2 parsing with NHapi. Mapping to FHIR POCOs using Firely SDK.
4. SMART on FHIR authentication (OAuth2/OpenID). Enforce scopes (patient/*, user/*, system/*).
5. Audit logging via FHIR `AuditEvent`, append-only.
6. Domain layer contains only business rules, no EF or infrastructure.
7. API: Minimal APIs with ProblemDetails for errors. Endpoints under `/fhir/...`.
8. Security: RLS, encryption (pgcrypto for sensitive columns), no PII in logs.
9. Tests: Unit tests for handlers, integration tests with PostgreSQL container.

## Do not
- Do not let Domain depend on EF or NHapi.
- Do not bypass Application layer when accessing DB in Api.
- Do not disable RLS/audit in production.

## Naming & conventions
- Namespace: HealthTech.{Layer}.{Feature}
- Commands/Queries: VerbNounCommand, VerbNounQuery
- Records for immutable DTOs.

---
